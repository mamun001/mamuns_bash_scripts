echo 
echo This script wil generate a csv file that is sharable with BUs
echo that has list of cifs mount points etc
echo from beths reports
echo
sleep 3

echo
if [ -z "$1" ];
  then
    echo
    echo this script needs Change Number as arg1
    echo
    echo No ARG1. EXITING
    echo
    sleep 3
    exit 1
  else
    echo we have no-empty arg1. good.
    echo
    CRN=$1
    echo Using $CRN as Change Number for File Names
    sleep 3
fi
echo
echo




#read -p "Please enter CR # (only digits)" CRN
echo CR=$CRN
sleep 3

echo name of the file with filer list: filers

FF=filers

if [ -f $FF ];
then
   echo "File $FF exists. Good."
else
   echo "File $FF does not exist."
   echo make a file called $FF and put filer names there.
   echo and then rerun the script
   exit 0
fi

echo
DATAF1=beth_cis_2015_jul_20.csv
if [ -f $DATAF1 ];
then
   echo "File $DATAF1 exists.Good"
else
   echo "File $DATAF1 does not exist."
   echo copy the .csv file to this dir and
   echo rerun the script
   exit 0
fi


echo
DATAF2=beth_cps_2015_jul_20.csv
if [ -f $DATAF2 ];
then
   echo "File $DATAF2 exists."
else
   echo "File $DATAF2 does not exist."
   echo copy the .csv file to this dir and
   echo rerun the script
   exit 0
fi


# removing junk files
touch junk.1
rm junk*



# appending each filers cifs list
echo
RF=junk.all.appended.csv
touch $RF
rm $RF
touch $RF

#header line
echo "Filer,CIFS Mount Point Qtree,CIFS Share Name" > $RF
for i in $( cat $FF ); do
     #
     # 1: filer name 6:mount mount 7:CIFS shares
     grep -i $i $DATAF1 | cut -d, -f1,6,7 | egrep -i "vol|snap|vfiler" >> $RF 
     grep -i $i $DATAF2 | cut -d, -f1,6,7 | egrep -i "vol|snap|vfiler" >> $RF
  done

#cat $RF
# results
echo ______________________________________
echo Results saved as junk.all.appended.csv
echo 3 columns: Filer Name: Mount Point - Qtree: SHARE NAME
echo 3rd Column gives the biggest clues about what it really is.
echo For example: dacfgs arc201505 timeseries sqlarch cobalt dba_mssql
echo   dacdve esblogs HOME onesourcetax TSDB
echo ______________________________________
sleep 3


# check for critical cifs volumes that we can not ignore
# first lets takeout col 3
cut -d, -f3 $RF > junk.cifs.share.names
sort junk.cifs.share.names | uniq | sort > junk.uniq.shares
cat junk.uniq.shares
echo ____________________________________________
echo WARNING:The following serious CIFS volumes exist here
egrep -i 'fgs|arc2|times|sql|cobalt|dba|dve|esb|onesource|tsdb' junk.uniq.shares
echo ______________________________________________________





echo
echo copying to c-cygwin64 so that you can attach the file to email or CR
V1=CR
V2=$CRN
V3=_CIFS_VOLUME_INFO_ATTACHABLE.csv
FULLNAME=$V1$V2$V3
#echo $FULLNAME
cp junk.all.appended.csv /cygdrive/c/cygwin64/$FULLNAME
echo Find $FULLNAME in C:CYGWIN64 to attach 
echo _____________________________________________________________________
